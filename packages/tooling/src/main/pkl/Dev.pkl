/// Project development settings and configurations.
@ModuleInfo { minPklVersion = "0.28.1" }
module elide.dev

import "Base.pkl" as _common
import "Builder.pkl" as _builder
import "Flags.pkl" as _flags
import "ci/ContinuousIntegration.pkl" as ci

/// Source platform where the project is hosted.
typealias SourcePlatform = "github" | "gitlab" | "bitbucket" | "git" | String

/// Base class for project source information.
abstract class ProjectSourceInfo

/// GitHub project source information.
class Github extends ProjectSourceInfo {
  /// Repository for this project.
  repo: String
}

/// Project source configuration.
class ProjectSourceSpec {
  /// Platform which holds this project's source.
  platform: SourcePlatform?

  /// Project name or path.
  project: String?

  /// Subpath for this project, as applicable.
  subpath: String?
}

/// LSP (Language Server Protocol) settings for the project.
class LspSettings {
  /// Additional delegated LSP servers, in the format `[languageId@][[host]:port]`.
  delegates: Listing<String> = new {}
}

/// Declaration for an MCP resource.
class McpResource {
  /// Path to the file.
  path: _common.FilePath

  /// Resource name
  name: String = ""

  /// Resource description
  description: String = ""

  /// Mime type to explicitly set; one is detected if not provided.
  mimeType: String?
}

/// Settings for Model Context Protocol (MCP) servers.
class McpSettings {
  /// Additional MCP resources to be used by the project.
  resources: Listing<McpResource> = new {}

  /// Whether to register Elide as an MCP tool.
  registerElide: Boolean = true

  /// Whether to register project advice with MCP.
  advice: Boolean = true
}

/// Development server settings for the project.
class DevServerSettings {
  /// Host to listen on.
  host: String = "0.0.0.0"

  /// Port to listen on.
  port: UInt16 = 8080
}

/// Development settings for the project.
class DevSettings {
  /// Source info for the project.
  source: ProjectSourceSpec?

  /// Settings which apply to the project's language server.
  lsp: LspSettings?

  /// Settings which apply to Model Context Protocol (MCP) servers.
  mcp: McpSettings?

  /// Development server settings for the project.
  server: DevServerSettings?

  /// Settings which govern this project's builder.
  builder: _builder.BuilderSettings?

  /// Settings which govern this project's test runner.
  testrunner: _builder.TestRunnerSettings?

  /// Mapping of configured project flags.
  flags: Listing<_flags.ProjectFlag> = new {}
}
